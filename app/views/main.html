<md-toolbar ng-show="formHidden" layout="row" class="md-hue-1">
    <div class="md-toolbar-tools">
        <h3 class="subheader-text">
            <span>{{travelStart.name}} â‡’ {{travelEnd.name}}</span>
        </h3>
        <span flex></span>

        <md-button class="md-secondary" ng-click="toggleForm()">Change</md-button>

    </div>
</md-toolbar>
<div layout="column" flex>
    <md-whiteframe class="md-whiteframe-1dp" layout="column" layout-padding ng-show="!formHidden">
        <form>
            <div class="container" ng-if="allOperators==null">
                <br />
                <md-progress-linear mode="indeterminate"></md-progress-linear>
                <div class="bottom-block">
                    <span>Fetching operators...</span>
                </div>
            </div>

            <div class="container" ng-if="allOperators">

                <label>Operator</label>
                <md-autocomplete
                    md-no-cache="true"
                    md-selected-item="operator"
                    md-search-text="operatorSearchText"
                    md-selected-item-change="operatorChange(operator)"
                    md-autoselect="true"
                    md-items="operator in filterOperators(operatorSearchText)"
                    md-item-text="operator.Name"
                    md-min-length="0"
                    md-require-match="true"
                    placeholder="Pick Operator">
                    <md-item-template>
                        <span md-highlight-text="operatorSearchText">{{operator.Name}} (#{{operator.Id}})</span>
                    </md-item-template>
                    <md-not-found>
                      No operators matching "{{operatorSearchText}}" were found.
                    </md-not-found>
                </md-autocomplete>


                <div class="container" ng-if="operator.Name && !allStations && !allLines.length">
                    <br />
                    <md-progress-linear mode="indeterminate"></md-progress-linear>
                    <div class="bottom-block">
                        <span>Loading operator's stations &amp; lines...</span>
                    </div>
                </div>

                <div ng-if="operator && allStations">
                    <br />
                    <label>Origin</label>
                    <md-autocomplete
            			required
            			flex
                        md-no-cache="true"
            			md-input-name="travelStart"
            			md-selected-item="travelStart"
            			md-search-text="stationSearchTextStart"
            			md-selected-item-change="stationChange(travelStart,'start')"
                        md-autoselect="true"
            			md-items="station in stationQuerySearch(stationSearchTextStart, 'start')"
            			md-item-text="station.name"
            			md-min-length="0"
                        md-require-match="true"
            			placeholder="Travel start">
            			<md-item-template>
            				<span md-highlight-text="stationSearchTextStart">{{station.name}} (#{{station.id}})</span>
            			</md-item-template>
                        <md-not-found>
                          No stations matching "{{stationSearchTextStart}}" were found.
                        </md-not-found>
                  	</md-autocomplete>

                    <br />
                    <label>Destination</label>
                    <md-autocomplete
            			required
            			flex
                        md-no-cache="true"
            			md-input-name="travelEnd"
            			md-selected-item="travelEnd"
            			md-search-text="stationSearchTextEnd"
            			md-selected-item-change="stationChange(travelEnd,'stop')"
                        md-autoselect="true"
            			md-items="station in stationQuerySearch(stationSearchTextEnd, 'stop')"
            			md-item-text="station.name"
            			md-min-length="0"
                        md-require-match="true"
            			placeholder="Travel end">
            			<md-item-template>
            				<span md-highlight-text="stationSearchTextEnd">{{station.name}} (#{{station.id}})</span>
            			</md-item-template>
                        <md-not-found>
                          No stations matching "{{stationSearchTextEnd}}" were found.
                        </md-not-found>
                  	</md-autocomplete>
                    <br />
                    <div>
                        <md-button
                            class="md-raised md-primary"
                            ng-disabled="!travelStart || !travelEnd"
                            ng-click="stationsReady()">Ok</md-button>

                    </div>
                </div>
            </div>
        </form>
    </md-whiteframe>

    <md-tabs ng-if="routes" flex>
        <md-tab ng-repeat="route in routes"
              label="{{route.short_name}} ({{route.long_name}})">
            <md-list flex>
                <md-divider ></md-divider>
                <md-list-item class="md-3-line" ng-repeat="stopId in route.stopSequence">
                    <!-- <img ng-src="{{item.face}}?{{$index}}" class="md-avatar" alt="{{item.who}}" /> -->
                    <div class="md-list-item-text" layout="column">
                        <h3>{{ allStationsWKeys[stopId].name }}</h3>
                        <h4>Next stop times:
                            <span ng-repeat="(stopTime, stopTrips) in route.stopTimes[stopId]">
                                {{ stopTime }} : {{stopTrips.length}} bus(es)<span ng-if="!$last">, </span>
                            </span>
                        </h4>
                        <p>{{ item.notes }}</p>
                    </div>
                    <md-button class="md-secondary" ng-click="openStopTracker(route.id, stopId)"
                        aria-label="Open route details">
                        Details
                    </md-button>
                    <md-divider ></md-divider>
                </md-list-item>
            </md-list>
        </md-tabs>
    </md-tabs>
</div>
